CREATE DATABASE QUANLYBANHANG
GO

USE QUANLYBANHANG
GO

CREATE TABLE NHACUNGCAP 
( 
	MaCongTy 	varchar(10)	NOT NULL, 
	TenCongTy 	nvarchar(50) NOT NULL, 
	TenGiaoDich nvarchar(50), 
	DiaChi 		nvarchar(100), 
	DienThoai 	varchar(20), 
	Fax 		varchar(20), 
	Email 		varchar(50),
	CONSTRAINT PK_NHACUNGCAP PRIMARY KEY(MaCongTy) 
)
GO

CREATE TABLE LOAIHANG 
( 
	MaLoaiHang	int NOT NULL, 
	TenLoaiHang	nvarchar(50) NOT NULL,
	CONSTRAINT PK_LOAIHANG PRIMARY KEY(MaLoaiHang)
)
GO

CREATE TABLE MATHANG 
( 
	MaHang 		varchar(10) NOT NULL,
	TenHang 	nvarchar(50) NOT NULL,
	MaCongTy 	varchar(10),
	MaLoaiHang 	int,
	SoLuong 	int,
	DonViTinh 	nvarchar(20),
	GiaHang 	money,
	CONSTRAINT PK_MATHANG PRIMARY KEY(MaHang)	
)
GO

CREATE TABLE NHANVIEN 
( 
	MaNhanVien 	varchar(10) NOT NULL,
	Ho			nvarchar(50) NOT NULL,
	Ten			nvarchar(50) NOT NULL,
	NgaySinh	date,
	NgayLamViec date,
	DiaChi 		nvarchar(50),
	DienThoai	varchar(20),
	LuongCoBan 	money,
	PhuCap 		money,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY(MaNhanVien)
)
GO


CREATE TABLE KHACHHANG 
( 
	MaKhachHang varchar(10) NOT NULL, 
	TenCongTy 	nvarchar(50) NOT NULL,
	TenGiaoDich nvarchar(50), 
	DiaChi 		nvarchar(50),
	Email 		varchar(50),
	DienThoai 	varchar(20),
	Fax			varchar(20),
	CONSTRAINT PK_KHACHHANG PRIMARY KEY(MaKhachHang)
)
GO

CREATE TABLE DONDATHANG 
( 
	SoHoaDon	int NOT NULL,
	MaKhachHang	varchar(10),
	MaNhanVien 	varchar(10),
	NgayDatHang	date,
	NgayGiaoHang date,
	NgayChuyenHang date,
	NoiGiaoHang	nvarchar(50),
	CONSTRAINT PK_DONDATHANG PRIMARY KEY(SoHoaDon)
)
GO

CREATE TABLE CHITIETDATHANG 
(
	SoHoaDon	int	NOT NULL,
	MaHang 		varchar(10)	NOT NULL,
	GiaBan 		money,
	SoLuong		int,
	MucGiamGia 	real,
	CONSTRAINT PK_CHITIETDATHANG PRIMARY KEY(SoHoaDon,MaHang)
)
GO

ALTER TABLE MATHANG ADD
CONSTRAINT FK_MATHANG_LOAIHANG FOREIGN KEY(MaLoaiHang) REFERENCES LOAIHANG(MaLoaiHang)
ON DELETE CASCADE ON UPDATE CASCADE, 
CONSTRAINT FK_MATHANG_NHACUNGCAP FOREIGN KEY(MaCongTy) REFERENCES NHACUNGCAP(MaCongTy)
ON DELETE CASCADE ON UPDATE CASCADE
GO


ALTER TABLE DONDATHANG ADD
CONSTRAINT FK_DONDATHANG_KHACHHANG FOREIGN KEY(MaKhachHang) REFERENCES KHACHHANG(MaKhachHang)
ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT FK_DONDATHANG_NHANVIEN FOREIGN KEY(MaNhanVien) REFERENCES NHANVIEN(MaNhanVien) 
ON DELETE CASCADE ON UPDATE CASCADE
GO


ALTER TABLE CHITIETDATHANG ADD 
CONSTRAINT FK_CHITIET_DONDATHANG FOREIGN KEY(SoHoaDon) REFERENCES DONDATHANG(SoHoaDon) 
ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT FK_CHITIET_MATHANG FOREIGN KEY(MaHang) REFERENCES MATHANG(MaHang) 
ON DELETE CASCADE ON UPDATE CASCADE
GO


ALTER TABLE CHITIETDATHANG ADD 
CONSTRAINT DF_CHITIETDATHANG_SOLUONG DEFAULT(1) FOR SoLuong, 
CONSTRAINT DF_CHITIETDATHANG_MUCGIAMGIA DEFAULT(0) FOR MucGiamGia
GO


ALTER TABLE DONDATHANG ADD 
CONSTRAINT CHK_DONDATHANG_NGAY CHECK 
(NgayGiaoHang>=NgayDatHang AND NgayChuyenHang>=NgayDatHang)
GO


ALTER TABLE NHANVIEN ADD 
CONSTRAINT CHK_NHANVIEN_NGAYLAMVIEC CHECK 
(DATEDIFF(YY,NgaySinh,NgayLamViec) BETWEEN 18 AND 60)
GO

--Thiet lap dinh dang nhap du lieu theo ngay/thang/nam
SET DATEFORMAT DMY
GO


--Nhap du lieu cho bang KHACHHANG
INSERT INTO KHACHHANG VALUES ('0001','THANH CONG','THANH CONG','185 LE HONG PHONG',NULL,NULL,NULL)
INSERT INTO KHACHHANG VALUES ('0002','CONG THANH','CONG THANH','209 NGUYEN TRAI',NULL,NULL,NULL)
INSERT INTO KHACHHANG VALUES ('0003','DAN THANH','DAN THANH',NULL,NULL,NULL,NULL)
INSERT INTO KHACHHANG VALUES ('0004','THANH DAN','THANH DAN',NULL,NULL,NULL,NULL)
INSERT INTO KHACHHANG VALUES ('0005','KHAI TRI','KHAI TRI',NULL,NULL,NULL,NULL)
INSERT INTO KHACHHANG VALUES ('0006','PHONG VU','PHONG VU',NULL,NULL,NULL,NULL)
INSERT INTO KHACHHANG VALUES ('0007','DAN DA','DAN DA',NULL,NULL,NULL,NULL)
INSERT INTO KHACHHANG VALUES ('A002','VINAMILK','VINAMILK',NULL,NULL,NULL,NULL)
GO

--Nhap du lieu cho bang NHANVIEN
INSERT INTO NHANVIEN VALUES ('111','NGUYEN','VAN THANH','1/1/2000','12/12/2020',NULL,NULL,5000000,500000)
INSERT INTO NHANVIEN VALUES ('112','DINH','MANH LINH','2/2/2000','12/12/2020',NULL,NULL,4000000,400000)
INSERT INTO NHANVIEN VALUES ('113','LE','LAN TRINH','12/12/2000','12/12/2020',NULL,NULL,3000000,300000)
INSERT INTO NHANVIEN VALUES ('114','NGUYEN','TRAN NHU','12/12/2000','12/12/2020',NULL,NULL,2000000,200000)
INSERT INTO NHANVIEN VALUES ('115','HUYNH','VAN THANG','12/12/2000','12/12/2020',NULL,NULL,6000000,600000)
INSERT INTO NHANVIEN VALUES ('116','TRAN','VAN THAI','2/2/2000','12/12/2020',NULL,NULL,2000000,200000)
INSERT INTO NHANVIEN VALUES ('117','NGUYEN','THI THAO','1/1/2000','12/12/2020',NULL,NULL,5000000,500000)
GO

--Nhap du lieu cho bang NHACUNGCAP
INSERT INTO NHACUNGCAP VALUES ('A001','VIET TIEN','MAY VT',NULL,NULL,NULL,NULL)
INSERT INTO NHACUNGCAP VALUES ('A002','VINAMILK','VINAMILK','321 THANH THAI','666222111',NULL,NULL)
INSERT INTO NHACUNGCAP VALUES ('A003','TRUNG NGUYEN','G7 CAFE',NULL,NULL,NULL,NULL)
INSERT INTO NHACUNGCAP VALUES ('A004','PHONG VU','MAY TINH PV',NULL,NULL,NULL,NULL)
INSERT INTO NHACUNGCAP VALUES ('A005','PHU QUOC','NUOC MAM PQ',NULL,NULL,NULL,NULL)
INSERT INTO NHACUNGCAP VALUES ('A006','RAU SACH','RAU SACH',NULL,NULL,NULL,NULL)
INSERT INTO NHACUNGCAP VALUES ('A007','VN FOOD','VINAFOOD',NULL,NULL,NULL,NULL)
INSERT INTO NHACUNGCAP VALUES ('A008','DUONG BIEN HOA','BANH KEO BH',NULL,NULL,NULL,NULL)
INSERT INTO NHACUNGCAP VALUES ('A009','THANH NHAN','THANH NHAN TH',NULL,NULL,NULL,NULL)
GO


--Nhap du lieu cho bang LOAIHANG
INSERT INTO LOAIHANG VALUES (01,'TIEU DUNG')
INSERT INTO LOAIHANG VALUES (02,'DIEN TU')
INSERT INTO LOAIHANG VALUES (03,'THUC AN')
INSERT INTO LOAIHANG VALUES (04,'THUC UONG')
INSERT INTO LOAIHANG VALUES (05,'MAY MAC')
INSERT INTO LOAIHANG VALUES (06,'XA XI PHAM')
INSERT INTO LOAIHANG VALUES (07,'THUOC MEN')
INSERT INTO LOAIHANG VALUES (08,'THUC PHAM')
GO

--Nhap du lieu cho bang MATHANG
INSERT INTO MATHANG VALUES ('123','SUA HOP','A002',08,1,'HOP',5000)
INSERT INTO MATHANG VALUES ('124','DUONG','A008',08,1,'KG',3000)
INSERT INTO MATHANG VALUES ('125','RAU','A006',08,1,'KG',2000)
INSERT INTO MATHANG VALUES ('126','NUOC MAM','A005',08,1,'CHAI',10000)
INSERT INTO MATHANG VALUES ('127','MI AN LIEN','A007',08,1,'GOI',2000)
INSERT INTO MATHANG VALUES ('128','CA PHE','A003',08,1,'HOP',30000)
GO


--Nhap du lieu cho bang DONDATHANG
INSERT INTO DONDATHANG VALUES (1,'0001','111','1/1/2020','3/4/2020','4/5/2020','185 LE HONG PHONG')
INSERT INTO DONDATHANG VALUES (2,'0002','112','2/2/2020','3/4/2020','4/5/2020','209 NGUYEN TRAI')
INSERT INTO DONDATHANG VALUES (3,'0003','113','3/3/2020','3/4/2020','4/5/2020',NULL)
INSERT INTO DONDATHANG VALUES (4,'0004','114','4/4/2020','5/6/2020','6/7/2020',NULL)
INSERT INTO DONDATHANG VALUES (5,'0005','115','5/5/2020','7/8/2020','9/10/2020',NULL)
INSERT INTO DONDATHANG VALUES (6,'0006','116','6/6/2020','8/9/2020','9/10/2020',NULL)
GO


--Nhap du lieu cho bang CHITIETDATHANG
INSERT INTO CHITIETDATHANG VALUES (1,'123',5500,5,0)
INSERT INTO CHITIETDATHANG VALUES (1,'124',4000,3,0)
INSERT INTO CHITIETDATHANG VALUES (1,'126',11000,5,0)
INSERT INTO CHITIETDATHANG VALUES (2,'123',5500,5,0)
INSERT INTO CHITIETDATHANG VALUES (2,'125',1500,5,0)
INSERT INTO CHITIETDATHANG VALUES (2,'124',4000,3,0)
INSERT INTO CHITIETDATHANG VALUES (2,'127',11000,5,0)
INSERT INTO CHITIETDATHANG VALUES (3,'126',11000,5,0)
INSERT INTO CHITIETDATHANG VALUES (3,'123',5500,5,0)
INSERT INTO CHITIETDATHANG VALUES (3,'125',1500,5,0)
INSERT INTO CHITIETDATHANG VALUES (3,'124',4000,3,0)
INSERT INTO CHITIETDATHANG VALUES (4,'123',5500,50,0)
INSERT INTO CHITIETDATHANG VALUES (4,'124',4000,30,0)
INSERT INTO CHITIETDATHANG VALUES (5,'125',1500,20,0)
INSERT INTO CHITIETDATHANG VALUES (5,'126',11000,20,0)
INSERT INTO CHITIETDATHANG VALUES (6,'127',11000,31,0)
INSERT INTO CHITIETDATHANG VALUES (6,'123',55000,10,0)
GO

